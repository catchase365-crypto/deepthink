<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini 迭代进化器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @keyframes pulse-gold {
            0%, 100% { box-shadow: 0 0 0 0 rgba(234, 179, 8, 0.4); }
            50% { box-shadow: 0 0 20px 10px rgba(234, 179, 8, 0.2); }
        }
        .evolving { animation: pulse-gold 2s infinite; }
    </style>
</head>
<body class="bg-slate-900 text-slate-100 min-h-screen p-4 md:p-8 font-sans">

    <div class="max-w-4xl mx-auto space-y-6">
        <header class="text-center space-y-2">
            <h1 class="text-4xl font-black bg-clip-text text-transparent bg-gradient-to-r from-blue-400 to-emerald-400">Gemini 自动进化思维</h1>
            <p class="text-slate-400">通过无止尽的迭代将答案推向极致精髓</p>
        </header>

        <div class="bg-slate-800 p-6 rounded-2xl shadow-xl border border-slate-700 space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-1">Gemini API Key</label>
                    <input type="password" id="apiKey" placeholder="输入你的 Google AI API Key" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                </div>
                <div>
                    <label class="block text-sm font-medium text-slate-400 mb-1">迭代模型选择</label>
                    <select id="modelSelect" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none">
                        <option value="gemini-2.5-flash-lite">Gemini 2.5 Flash Lite </option>
                        <option value="gemini-3-flash-preview">Gemini 3 Flash Preview</option>
                    </select>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-400 mb-1">初始问题 / 核心命题</label>
                <textarea id="userInput" rows="3" placeholder="你想要探讨的终极课题是？" class="w-full bg-slate-900 border border-slate-600 rounded-lg px-4 py-2 focus:ring-2 focus:ring-blue-500 outline-none resize-none"></textarea>
            </div>
            <div class="flex gap-4">
                <button id="startBtn" class="flex-1 bg-blue-600 hover:bg-blue-500 text-white font-bold py-3 rounded-lg transition-all">开始进化</button>
                <button id="stopBtn" disabled class="flex-1 bg-red-600 hover:bg-red-500 text-white font-bold py-3 rounded-lg transition-all opacity-50 cursor-not-allowed">停止迭代</button>
            </div>
        </div>

        <div id="statusPanel" class="hidden flex items-center justify-between bg-slate-800 border-l-4 border-yellow-500 p-4 rounded-r-lg">
            <div class="flex items-center gap-3">
                <div class="w-3 h-3 bg-yellow-500 rounded-full animate-ping"></div>
                <span class="font-mono text-lg">正在炼金：第 <span id="genCount" class="text-yellow-400 font-bold">0</span> 代</span>
            </div>
            <div id="loader" class="text-sm text-slate-400">等待响应...</div>
        </div>

        <div id="resultArea" class="relative bg-slate-800 rounded-2xl p-8 border border-slate-700 min-h-[300px] leading-relaxed">
            <div id="placeholder" class="absolute inset-0 flex items-center justify-center text-slate-600">
                等待进化开始...
            </div>
            <div id="content" class="prose prose-invert max-w-none whitespace-pre-wrap">
            </div>
        </div>
    </div>

    <script>
        let isRunning = false;
        let generation = 0;
        let currentContent = "";
        let originalQuestion = "";
        const dimensions = ["逻辑严密性（强化论证与因果链条）", "极致简洁度（去冗余，直击灵魂核心）", "实践指导性（将概念转化为可落地的智慧）"];

        const apiKeyInput = document.getElementById('apiKey');
        const modelSelect = document.getElementById('modelSelect');
        const userInput = document.getElementById('userInput');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const genCountText = document.getElementById('genCount');
        const contentDiv = document.getElementById('content');
        const statusPanel = document.getElementById('statusPanel');
        const placeholder = document.getElementById('placeholder');
        const resultArea = document.getElementById('resultArea');

        startBtn.onclick = async () => {
            if (!apiKeyInput.value) return alert("请输入 API Key");
            if (!userInput.value) return alert("请输入问题");

            isRunning = true;
            generation = 0;
            originalQuestion = userInput.value;
            currentContent = "";
            
            startBtn.disabled = true;
            startBtn.classList.add('opacity-50');
            stopBtn.disabled = false;
            stopBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            statusPanel.classList.remove('hidden');
            placeholder.classList.add('hidden');
            resultArea.classList.add('evolving');
            
            iterate();
        };

        stopBtn.onclick = () => {
            isRunning = false;
            stopBtn.disabled = true;
            stopBtn.classList.add('opacity-50');
            startBtn.disabled = false;
            startBtn.classList.remove('opacity-50');
            resultArea.classList.remove('evolving');
            document.getElementById('loader').innerText = "迭代已停止";
        };

        async function iterate() {
            if (!isRunning) return;

            generation++;
            genCountText.innerText = generation;
            document.getElementById('loader').innerText = "正在深思...";

            const currentDimension = dimensions[(generation - 1) % dimensions.length];
            const prompt = generation === 1 
                ? `请深入浅出地回答这个问题，力求直接切入本质：${originalQuestion}`
                : `【核心命题】：${originalQuestion}\n【前代成果】：${currentContent}\n\n请作为顶级进化智者执行以下步骤：\n1. 自我批评：列出前代成果中的2个逻辑漏洞或认知局限。\n2. 核心提取：识别并保留最关键的底层逻辑要点。\n3. 维度迭代：基于“${currentDimension}”视角，结合上述批评进行重构升华。\n\n请直接输出进化后的纯净文本（不要包含第一二步的草稿内容）。`;

            try {
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/${modelSelect.value}:generateContent?key=${apiKeyInput.value}`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{ parts: [{ text: prompt }] }],
                        generationConfig: {
                            // 随代数增加降低随机性，促使结论收敛
                            temperature: Math.max(0.1, 0.8 - (generation * 0.08)),
                            topP: 0.95,
                        }
                    })
                });

                const data = await response.json();
                if (data.error) throw new Error(data.error.message);

                const newText = data.candidates[0].content.parts[0].text;
                currentContent = newText;
                contentDiv.innerText = currentContent;
                
                document.getElementById('loader').innerText = "进化完成，准备下一轮...";
                
                if (isRunning) {
                    setTimeout(iterate, 1500); // 稍微延迟防止触发频率限制
                }

            } catch (err) {
                console.error(err);
                contentDiv.innerHTML += `\n\n<span class="text-red-400">[进化中断]: ${err.message}</span>`;
                stopBtn.click();
            }
        }
    </script>
</body>
</html>